(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(t,e,c){t.exports=c("zUnb")},zUnb:function(t,e,c){"use strict";c.r(e);var o=c("fXoL");var n=c("jhN1"),a=c("tyNb"),r=c("ofXK");class s{constructor(t,e){this.id=t,this.model=e,this.isNew=!1}get address(){return this.model.address}set address(t){this.model.address=t}get createdAt(){return this.model.createdAt.toDate()}set createdAt(t){this.model.createdAt=t}get geometry(){const t=new Array;return t.push(this.latitude),t.push(this.longitude),t}get filename(){return void 0===this.model.filename?void 0:`http://smtp.teledesk.ru/${this.model.filename}`}get placemarkProperties(){const t=new r.e("en-US");return{hintContent:this.title,balloonContent:`<p>${t.transform(this.createdAt,"dd.MM.yyyy hh:mm")}</p>${this.title}`}}get placemarkOptions(){return{iconColor:"red",preset:this.isNew?"islands#redCircleDotIcon":"islands#redDotIcon"}}get latitude(){return this.model.latitude}get longitude(){return this.model.longitude}get title(){return this.model.title}get phone(){return this.model.phone}toModel(){return this.model}}var i=c("lJxs"),l=c("S/Aq"),p=c("BAab");class d{constructor(t,e){this.fireStore=t,this.storage=e,this.path="alerts"}get(){return this.fireStore.collection(this.path).snapshotChanges().pipe(Object(i.a)(t=>t.map(t=>{const e=t.payload.doc.data(),c=t.payload.doc.id;return new s(c,e)})))}add(t){return this.fireStore.collection(`${this.path}`).add(t.toModel())}delete(t){return this.fireStore.doc(`/${this.path}/${t}`).delete()}update(t){return this.fireStore.doc(`/${this.path}/${t.id}`).update(t.toModel())}}function u(t,e){if(1&t&&(o.qc(0,"tr"),o.qc(1,"td"),o.Vc(2),o.Bc(3,"date"),o.pc(),o.qc(4,"td"),o.Vc(5),o.pc(),o.qc(6,"td"),o.Vc(7),o.pc(),o.qc(8,"td"),o.Vc(9),o.pc(),o.qc(10,"td"),o.Vc(11),o.pc(),o.qc(12,"td"),o.Vc(13),o.pc(),o.qc(14,"td"),o.Vc(15),o.pc(),o.pc()),2&t){const t=e.$implicit;o.Yb(2),o.Wc(o.Dc(3,7,t.createdAt,"dd.MM.yyyy HH:mm:ss")),o.Yb(3),o.Wc(t.phone),o.Yb(2),o.Wc(t.toModel().address),o.Yb(2),o.Wc(t.toModel().longitude),o.Yb(2),o.Wc(t.toModel().latitude),o.Yb(2),o.Wc(t.toModel().title),o.Yb(2),o.Wc(t.filename)}}function h(t,e){if(1&t&&(o.oc(0),o.qc(1,"table",1),o.qc(2,"thead"),o.qc(3,"tr"),o.qc(4,"th"),o.Vc(5," \u0414\u0430\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f "),o.pc(),o.qc(6,"th"),o.Vc(7," \u0422\u0435\u043b\u0435\u0444\u043e\u043d "),o.pc(),o.qc(8,"th"),o.Vc(9," \u0410\u0434\u0440\u0435\u0441 "),o.pc(),o.qc(10,"th"),o.Vc(11," \u0414\u043e\u043b\u0433\u043e\u0442\u0430 "),o.pc(),o.qc(12,"th"),o.Vc(13," \u0428\u0438\u0440\u0438\u043d\u0430 "),o.pc(),o.qc(14,"th"),o.Vc(15," \u041f\u043e\u043b\u043d\u044b\u0439 \u0430\u0434\u0440\u0435\u0441 "),o.pc(),o.qc(16,"th"),o.Vc(17," \u0417\u0432\u0443\u043a\u043e\u0432\u043e\u0439 \u0444\u0430\u0439\u043b "),o.pc(),o.pc(),o.pc(),o.qc(18,"tbody"),o.Tc(19,u,16,10,"tr",2),o.pc(),o.pc(),o.nc()),2&t){const t=o.Ac();o.Yb(19),o.Gc("ngForOf",t.alerts)}}d.\u0275fac=function(t){return new(t||d)(o.uc(l.a),o.uc(p.a))},d.\u0275prov=o.gc({token:d,factory:d.\u0275fac,providedIn:"root"});class m{constructor(t){this.alertService=t}ngOnInit(){this.alertService.get().subscribe(t=>{this.alerts=t.sort((t,e)=>e.createdAt.getTime()-t.createdAt.getTime()),console.log(t)})}}m.\u0275fac=function(t){return new(t||m)(o.kc(d))},m.\u0275cmp=o.ec({type:m,selectors:[["app-alerts"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"table","table-bordered"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&o.Tc(0,h,20,1,"ng-container",0),2&t&&o.Gc("ngIf",e.alerts)},directives:[r.m,r.l],pipes:[r.e],styles:[""]});var f=c("GUpj");class g{constructor(t){this.alertService=t}ngOnInit(){const t=f.map("map",{center:[55.03573,82.896184],zoom:16,fullscreenControl:!1});t&&console.log("Map added"),this.alertService.get().subscribe(e=>{e.forEach(e=>{if(void 0===e.toModel().longitude)return;const c=f.marker([e.toModel().latitude,e.toModel().longitude]);c.addTo(t).bindPopup(e.toModel().title),c.on("click",()=>{}),console.log("Marker after adding:"+c.getLatLng())})}),t.on("click",(function(t){const e=f.marker([t.latlng.lat,t.latlng.lng]);console.log("Marker after adding:"+e.getLatLng())}))}}g.\u0275fac=function(t){return new(t||g)(o.kc(d))},g.\u0275cmp=o.ec({type:g,selectors:[["app-map"]],decls:1,vars:0,consts:[["id","map",2,"width","100%","height","800px"]],template:function(t,e){1&t&&o.lc(0,"div",0)},styles:[""]});var b=c("dyI5");class y{constructor(t){this.alertService=t}ngOnInit(){b.a.load().then(t=>{const e=new t.Map("map",{center:[55.030199,82.92043],zoom:16});this.alertService.get().subscribe(t=>{t.forEach(t=>{void 0!==t.toModel().longitude&&e.geoObjects.add(new b.a.Placemark([55.642063,37.656123],{balloonContent:"\u0446\u0432\u0435\u0442 <strong>\u043a\u0440\u0430\u0441\u043d\u044b\u0439</strong>"},{preset:"islands#redSportIcon"}))})})}).catch(t=>console.log("Failed to load Yandex Maps",t))}}y.\u0275fac=function(t){return new(t||y)(o.kc(d))},y.\u0275cmp=o.ec({type:y,selectors:[["app-ymap"]],decls:1,vars:0,consts:[["id","map",2,"width","100%","height","700px"]],template:function(t,e){1&t&&o.lc(0,"div",0)},styles:[""]});var v=c("mrSG"),k=c("7avB");class w{constructor(t){this.alertService=t,this.close=new o.u}ngOnInit(){}play(){return Object(v.__awaiter)(this,void 0,void 0,(function*(){const t=new Audio;t.src=this.alert.filename,t.load(),yield t.play()}))}close_Click(){return Object(v.__awaiter)(this,void 0,void 0,(function*(){confirm(`\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443  ${this.alert.address}?`)&&(this.close.emit(this.placemark),yield this.alertService.delete(this.alert.id))}))}}function q(t,e){if(1&t){const t=o.rc();o.qc(0,"app-placemark",2),o.yc("close",(function(e){return o.Nc(t),o.Ac().close(e)})),o.pc()}if(2&t){const t=o.Ac();o.Gc("alert",t.alert)("placemark",t.placemark)}}w.\u0275fac=function(t){return new(t||w)(o.kc(d))},w.\u0275cmp=o.ec({type:w,selectors:[["app-placemark"]],inputs:{alert:"alert",placemark:"placemark"},outputs:{close:"close"},decls:13,vars:6,consts:[[3,"click"]],template:function(t,e){1&t&&(o.qc(0,"p"),o.Vc(1),o.Bc(2,"date"),o.pc(),o.qc(3,"p"),o.Vc(4),o.pc(),o.qc(5,"p"),o.Vc(6),o.pc(),o.qc(7,"p"),o.qc(8,"button",0),o.yc("click",(function(){return e.play()})),o.Vc(9,"\u041f\u0440\u043e\u0441\u043b\u0443\u0448\u0430\u0442\u044c"),o.pc(),o.pc(),o.qc(10,"p"),o.qc(11,"button",0),o.yc("click",(function(){return e.close_Click()})),o.Vc(12,"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"),o.pc(),o.pc()),2&t&&(o.Yb(1),o.Wc(o.Dc(2,3,e.alert.createdAt,"dd.MM.yyyy hh:mm")),o.Yb(3),o.Wc(e.alert.title),o.Yb(2),o.Wc(e.alert.phone))},pipes:[r.e],styles:["[_nghost-%COMP%]{position:absolute;right:10px;bottom:50px;top:70px;width:255px;background:azure;z-index:9999990;overflow:auto;padding-left:5px}"]});const M=function(){return[55.030199,82.92043]};class I{constructor(t,e,c){this.alertService=t,this.cdr=e,this.applicationRef=c,this.alerts=void 0}ngOnInit(){}balloonClick(t){console.log(t),"balloonopen"===t.type?(this.alert=t.alert,this.placemark=t.placemark):(this.alert=void 0,this.placemark=void 0),this.applicationRef.tick(),this.cdr.detectChanges()}load(t){this.map=t,console.log("load"),console.log(this.map),this.alertService.get().subscribe(t=>{if(null===t)return;this.alerts&&t.filter(t=>!this.alerts.map(t=>t.id).includes(t.id)).forEach(t=>Object(v.__awaiter)(this,void 0,void 0,(function*(){t.isNew=!0,console.log(t);const e=new Audio;e.src=t.filename,e.load(),yield e.play()}))),this.alerts=t;const e=new ymaps.GeoObjectCollection;this.map.instance.geoObjects.add(e),e.removeAll(),t.forEach(t=>{const e=new ymaps.Placemark(t.geometry,t.placemarkProperties,t.placemarkOptions);e.events.add(["balloonopen","balloonclose"],c=>this.balloonClick({ymaps,instance:e,type:c.originalEvent.type,event:c,alert:t,placemark:e})),this.map.instance.geoObjects.add(e)})})}close(t){console.log(t),this.map.instance.geoObjects.remove(t)}}I.\u0275fac=function(t){return new(t||I)(o.kc(d),o.kc(o.j),o.kc(o.g))},I.\u0275cmp=o.ec({type:I,selectors:[["app-yandex-map"]],decls:2,vars:4,consts:[[3,"center","zoom","load"],[3,"alert","placemark","close",4,"ngIf"],[3,"alert","placemark","close"]],template:function(t,e){1&t&&(o.qc(0,"angular-yandex-map",0),o.yc("load",(function(t){return e.load(t)})),o.pc(),o.Tc(1,q,1,2,"app-placemark",1)),2&t&&(o.Gc("center",o.Ic(3,M))("zoom",12),o.Yb(1),o.Gc("ngIf",e.alert))},directives:[k.b,r.m,w],styles:[""]});class O{constructor(){}ngOnInit(){}}function A(t,e){if(1&t){const t=o.rc();o.qc(0,"button",3),o.yc("click",(function(){o.Nc(t);const e=o.Ac().$implicit;return o.Ac(2).play(e)})),o.Vc(1,"\u041f\u0440\u043e\u0441\u043b\u0443\u0448\u0430\u0442\u044c"),o.pc()}}function V(t,e){if(1&t&&(o.oc(0),o.qc(1,"p"),o.qc(2,"span"),o.Vc(3),o.Bc(4,"date"),o.pc(),o.Vc(5),o.Tc(6,A,2,0,"button",2),o.pc(),o.nc()),2&t){const t=e.$implicit;o.Yb(3),o.Wc(o.Dc(4,3,t.createdAt,"dd.MM.yyyy HH:mm:ss")),o.Yb(2),o.Xc(" ",t.title," "),o.Yb(1),o.Gc("ngIf",t.filename)}}function S(t,e){if(1&t&&(o.oc(0),o.Tc(1,V,7,6,"ng-container",1),o.nc()),2&t){const t=o.Ac();o.Yb(1),o.Gc("ngForOf",t.alerts)}}O.\u0275fac=function(t){return new(t||O)},O.\u0275cmp=o.ec({type:O,selectors:[["app-test"]],decls:2,vars:0,template:function(t,e){1&t&&(o.qc(0,"p"),o.Vc(1,"test works!"),o.pc())},styles:[""]});class x{constructor(t){this.alertService=t}ngOnInit(){this.alertService.get().subscribe(t=>{this.alerts=t.sort((t,e)=>e.createdAt.getTime()-t.createdAt.getTime()),console.log(t)})}play(t){return Object(v.__awaiter)(this,void 0,void 0,(function*(){console.log(t);const e=new Audio;e.src=t.filename,e.load(),yield e.play()}))}}x.\u0275fac=function(t){return new(t||x)(o.kc(d))},x.\u0275cmp=o.ec({type:x,selectors:[["app-sidebar"]],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],["nbButton","",3,"click",4,"ngIf"],["nbButton","",3,"click"]],template:function(t,e){1&t&&o.Tc(0,S,2,1,"ng-container",0),2&t&&o.Gc("ngIf",e.alerts)},directives:[r.m,r.l],pipes:[r.e],styles:["[_nghost-%COMP%]{overflow:auto}"]});class C{constructor(){}ngOnInit(){}change(){console.log("tets")}}C.\u0275fac=function(t){return new(t||C)},C.\u0275cmp=o.ec({type:C,selectors:[["app-main"]],decls:4,vars:0,consts:[[1,"map"],[1,"panel"]],template:function(t,e){1&t&&(o.qc(0,"div",0),o.lc(1,"router-outlet"),o.pc(),o.qc(2,"div",1),o.lc(3,"app-sidebar"),o.pc())},directives:[a.h,x],styles:[".map{width:100%;height:800px}.panel{position:absolute;right:10px;bottom:50px;top:70px;width:225px;background:azure;z-index:999999;overflow:auto;padding-left:5px}"],encapsulation:2});const j=[{path:"",component:C,children:[{path:"",component:I},{path:"alerts",component:m},{path:"map",component:g},{path:"ymap",component:y},{path:"yamap",component:I},{path:"test",component:O}]}];class z{}z.\u0275mod=o.ic({type:z}),z.\u0275inj=o.hc({factory:function(t){return new(t||z)},imports:[[a.g.forRoot(j)],a.g]});class Y{constructor(){this.title="MapAlert",console.log(this.title)}}Y.\u0275fac=function(t){return new(t||Y)},Y.\u0275cmp=o.ec({type:Y,selectors:[["app-root"]],decls:1,vars:0,template:function(t,e){1&t&&o.lc(0,"router-outlet")},directives:[a.h],styles:[""]});var _=c("ZfV3"),G=c("RZlo"),P=c("Czum"),T=c("NbQQ"),$=c("w7Ir"),N=c("aceb"),W=c("3Pt+"),D=c("cdP3");class B{}B.\u0275mod=o.ic({type:B,bootstrap:[Y]}),B.\u0275inj=o.hc({factory:function(t){return new(t||B)},providers:[N.c],imports:[[n.a,W.b,r.c,P.a.initializeApp({apiKey:"AIzaSyBzrzVtwElCgMQnSNUODhQlwh24jUetIRI",authDomain:"mapalert-99b0c.firebaseapp.com",databaseURL:"https://mapalert-99b0c.firebaseio.com",projectId:"mapalert-99b0c",storageBucket:"mapalert-99b0c.appspot.com",messagingSenderId:"1025639036588",appId:"1:1025639036588:web:c1f54cf30d57f54213d109",measurementId:"G-0931XJ839Q"}),T.a,$.a,_.a,G.a,k.a.forRoot("881d7e11-b250-45a9-b8c8-051f61f50266"),N.d.forRoot(),N.a,N.b,D.a.forRoot(),z]]}),n.c().bootstrapModule(B).catch(t=>console.error(t))},zn8P:function(t,e){function c(t){return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}c.keys=function(){return[]},c.resolve=c,t.exports=c,c.id="zn8P"}},[[0,0,5]]]);
//# sourceMappingURL=main-es2015.js.map